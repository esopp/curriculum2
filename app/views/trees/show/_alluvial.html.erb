<script type="text/javascript">

  data = {
    "data": [
        {
          "type": "sankey",
          "arrangment": "fixed",
          "showlegend": false,
          "domain": {
            "x": [
              0,
              1
            ],
            "y": [
              0,
              1
            ]
          },
          "node": {
            "x": JSON.parse('<%= alluvial_nodes_xpos.to_json.html_safe %>'),
            "y": JSON.parse('<%= alluvial_nodes_ypos.to_json.html_safe %>'),
            "pad": 20,
            "thickness": 20,
            "line": {
              "color": "black",
              "width": 0.5
            },
            "label": JSON.parse('<%= alluvial_nodes.to_json.html_safe %>'),
            "color": JSON.parse('<%= alluvial_node_colors.to_json.html_safe %>'),
          },
          "link": JSON.parse('<%= alluvial_links.to_json.html_safe %>')
        }],
    "layout": {
      "title": "<%= chart_name %>",
      "width": Math.floor($("#js-alluvial-container").width()) - 10,
      "height": (Math.floor($("#js-alluvial-container").height()) > 300 ? Math.floor($("#js-alluvial-container").height()) : 300),
      "font": {
          "size": 10
      },
    }
  }

  Plotly.plot('js-alluvial-container', data.data, data.layout);


  var resizeTimeout;
$(window).resize(function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(doneResizing, 500);
});

function doneResizing(){
  console.log('resiz even')
  data.layout["width"] = Math.floor($("#js-alluvial-container").width()) - 10;
  data.layout["height"] = (Math.floor($("#js-alluvial-container").height()) > 300 ? Math.floor($("#js-alluvial-container").height()) : 300);
    Plotly.plot(document.getElementById('js-alluvial-container'), data.data, data.layout);
}

</script>