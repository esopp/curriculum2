<% content_for(:title_code, 'trees.index.name') %>
<% content_for(:page_class, 'trees') %>

<br>
<div class='text-center sequence-page'>
  <h2 id="sequencing-header"><%= translate('trees.sequencing.title') %></h2>
  <div id="controls">
    <div>
      <button id="show-indicators" class="btn-info" onclick="showIndicators(true);">Show Indicators</button>
      <button id="hide-indicators" class="btn-info" onclick="showIndicators(false);" aria-hidden="true" hidden>Hide Indicators</button>
    </div>
    <% @s_o_hash.keys.each do |i| %>
      <div class='subj-checkbox'>
        <input id="check-<%= i %>" type="checkbox" onchange='subject_visibility("<%= i %>");' checked></input>
        <label for="check-<%= i %>">
          <%= @translations["subject.#{i}.name"] %>
        </label>
        <% if @subj_gradebands[i].length > 0 %>
          <i id="show-gb-controls-<%= i %>" class="rotate fa fa-angle-left down" onclick="toggle_visibility('#<%= i %>-gradebands-list', '#show-gb-controls-<%= i %>');"></i>
          <ul id="<%= i %>-gradebands-list" class="gradebands-list hidden">
            <% @subj_gradebands[i].each do |gb_code|%>
              <li>
              <input id="<%= i %>-gb-check-<%= gb_code %>" type="checkbox" onchange='gradeband_visibility("<%= i %>", "<%= gb_code %>");' checked></input>
              <label for="<%= i %>-gb-check-<%= gb_code %>">
                <%= I18n.t('app.labels.grade_band_num', num: gb_code) %>
              </label>
              </li>
            <% end #@subj_gradebands[i].each do |gb_code| %>
          </ul>
        <% end #if @subj_gradebands[i].length > 0 %>
      </div>
    <% end %>
  </div>
</div>
<div id="trees" class="sequence-page">
  <div class="sequence-grid cols-<%= @s_o_hash.keys.count %>">
	<% @s_o_hash.each do |i, j| %>
    <div id="<%=i%>-column" class="sequence-item subject-column">
      <ul class="list-group">
        <li class="sequence-header"><%= Translation.where(locale: @locale_code, key: @subjects[i].base_key + ".name").first.value %></li>
        <% j.each do |k| %>
          <li id="lo_<%= k[:id] %>" class="sequence-item sequence-item--collapsable list-group-item lo_gb_code_<%= k[:gb_code] %>" data-lo-id="<%= k[:id] %>">
            <a class="truncate-if-collapsed" href="<%= tree_path(k[:id])%>" title="<%= k[:text] %>"><%= k[:text] %></a>
            <% if @indicator_hash[k[:code]].length > 0 %>
              <div class="indicators-container hidden hide-if-collapsed"><strong>
                <%= translate('app.labels.indicators') %>:
              </strong>
              <% @indicator_hash[k[:code]].each do |indicator| %>
              <div>
                <strong><%= indicator[:label] %></strong>
                <%= indicator[:text] %>
              </div>
              <% end %>
              </div>
            <% end %>
            <% if k[:connections].length > 0 %>
              <div class="connections-div hide-if-collapsed" data-connections="<%= k[:connections].pluck(:tree_referencee_id) %>">
              <div><strong class='hide-unless-condition'><%= translate('trees.labels.outcome_connections') %></strong>
              </div>
                <% k[:connections].each do |c| %>
                  <% if c.active %>
                    <div class="hide-unless-condition block">
                      <% if current_user.present? && current_user.is_admin? %>
                      <a class="icon-link lo-handle negative-margin-left" title="<%= translate('app.labels.deactivate') %>" onclick="patch_tree_tree_activation(<%= c.id %>, 'false')">
                        <i class="fa fa-close"></i>
                      </a>
                      <a class="icon-link lo-handle" title="<%= translate('app.labels.edit') %>" onclick="edit_tree_tree(<%= c.id %>, 'false')">
                        <i class="fa fa-pencil"></i>
                      </a>
                      <% end %>
                      <div class="relationship-color-key spotlight-<%= c.relationship %>"></div>
                      <strong><%= translate('trees.labels.relation_types.' + c.relationship) %></strong>
                      <% ref = c.tree_referencee.subject.code + '.' + c.tree_referencee[:code] %>
                      <a href="<%= tree_path(c.tree_referencee_id)%>"
                      title= "<%= @translations[c.explanation_key] %>"><%= ref %></a>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <div class="pull-right">
               <a class="icon-link hide-if-collapsed lo-handle" onclick="related_LO_display(<%= k[:connections].map { | lo | [ lo[:relationship], lo[:tree_referencee_id]] } %>, <%= k[:id] %> );"><i class="fa fa-plug connections-icon pull-right" title="highlight connected LOs"></i></a>
            <% else %>
            <div class="pull-right">
            <% end %>
              <% if current_user.present? && current_user.is_admin? %>
                <a class="connect-handle lo-handle" onclick=""><i class="fa fa-link pull-right" title="make a connection between this LO and another"></i></a>
                <a class="sort-handle lo-handle" onclick=""><i class="fa fa-thumb-tack pull-right" title="resequence this LO within its subject"></i></a>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
  </div>
</div>
<div class="hidden">

</div>



